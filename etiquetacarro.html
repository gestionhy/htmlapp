<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Etiqueta Pallets - Don Yeyo</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        @page { size: A4; margin: 0; }
        * { box-sizing: border-box; }
        
        body { 
            font-family: 'Arial Black', 'Arial', sans-serif; 
            margin: 0; 
            padding: 5mm; 
            width: 210mm; 
            height: 296mm; 
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* --- ZONA 1: PRODUCTO (45%) --- */
        .zona-producto { 
            height: 45%; 
            display: flex;
            align-items: center; 
            justify-content: center;
            border-bottom: 5px solid black;
            overflow: hidden;
            padding: 0 10px;
        }
        #producto { 
            font-size: 130pt; 
            line-height: 0.85; 
            text-transform: uppercase; 
            text-align: center;
            word-break: break-all; 
            max-height: 100%;
        }

        /* --- ZONA 2: LOTE Y FECHAS (20%) --- */
        .zona-media { 
            height: 20%; 
            display: flex; 
            border-bottom: 5px solid black;
        }
        
        .caja-lote {
            width: 60%;
            border-right: 5px solid black;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
        }
        .etiqueta-flotante {
            position: absolute; top: 0; left: 0;
            background: black; color: white;
            font-size: 16pt; padding: 2px 10px;
        }
        #lote { 
            font-size: 60pt; 
            line-height: 1; 
            font-weight: bold;
        }

        .caja-fechas {
            width: 40%;
            display: flex;
            flex-direction: column;
        }
        .fila-fecha {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            border-bottom: 3px solid black;
            text-align: center;
            padding: 5px;
        }
        .fila-fecha:last-child { border-bottom: none; }
        
        .titulo-fecha { font-size: 10pt; font-family: Arial, sans-serif; }
        #vencimiento { font-size: 20pt; font-weight: bold; }
        #elaboracion { font-size: 14pt; font-weight: bold; line-height: 1.1; }

        /* --- ZONA 3: CANTIDADES Y QR (35%) --- */
        .zona-inferior { 
            height: 35%; 
            display: flex; 
        }
        .columna-datos {
            width: 55%;
            border-right: 5px solid black;
            display: flex;
            flex-direction: column;
        }
        .item-dato {
            flex: 1;
            border-bottom: 2px solid black;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 15px;
        }
        .item-dato:last-child { border-bottom: none; }
        
        .label-dato { font-size: 18pt; font-family: Arial, sans-serif; }
        .valor-dato { font-size: 45pt; font-weight: bold; }

        /* Estilo especial para Total Unidades si querés resaltarlo más */
        .item-total { background-color: #f0f0f0; } 

        .columna-qr {
            width: 45%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 10px;
        }
        #id-unico { font-size: 12pt; margin-bottom: 5px; font-weight: bold; font-family: Arial;}

    </style>
</head>
<body>

    <div class="zona-producto">
        <div id="producto">PRODUCTO</div>
    </div>

    <div class="zona-media">
        <div class="caja-lote">
            <span class="etiqueta-flotante">LOTE</span>
            <div id="lote">---</div>
        </div>
        <div class="caja-fechas">
            <div class="fila-fecha">
                <span class="titulo-fecha">VENCIMIENTO</span>
                <span class="valor-fecha" id="vencimiento">--/--/--</span>
            </div>
            <div class="fila-fecha">
                <span class="titulo-fecha">ELABORACIÓN</span>
                <span class="valor-fecha" id="elaboracion">--/--/-- --:--</span>
            </div>
        </div>
    </div>

    <div class="zona-inferior">
        <div class="columna-datos" id="contenedor-cantidades">
            </div>
        <div class="columna-qr">
            <div id="id-unico">ID: 0000</div>
            <div id="qrcode"></div>
        </div>
    </div>

    <script>
        function getParam(name) {
            const results = new RegExp('[\\?&]' + name + '=([^&#]*)').exec(window.location.href);
            return results ? decodeURIComponent(results[1].replace(/\+/g, ' ')) : '';
        }

        const d = {
            prod: getParam('producto') || 'HAMBURGUESA',
            lote: getParam('lote') || '---',
            venc: getParam('fecha_vencimiento') || '',
            elab: getParam('fecha') || '', 
            id: getParam('uniqueid') || '',
            // Cantidades
            total: getParam('cantidad_un') || '0', // Este es el TOTAL UNIDADES
            cajones: getParam('cantidad_cajones'),
            unidades: getParam('unidades'), // Estas son las sueltas/adicionales
            pallets: getParam('pallet'),
            cajas: getParam('cantidad_cajas')
        };

        // Render Fijos
        document.getElementById('producto').innerText = d.prod; 
        document.getElementById('lote').innerText = d.lote;
        document.getElementById('vencimiento').innerText = d.venc;
        document.getElementById('elaboracion').innerText = d.elab;
        document.getElementById('id-unico').innerText = "ID: " + d.id;

        // Render Dinámico Cantidades
        const cont = document.getElementById('contenedor-cantidades');
        
        // Definimos la lista. 'fijo: true' fuerza a que aparezca.
        const lista = [
            { l: 'TOTAL UNIDADES', v: d.total, fijo: true }, // ESTE SIEMPRE APARECE
            { l: 'CAJONES', v: d.cajones },
            { l: 'CAJAS', v: d.cajas },
            { l: 'UNID. SUELTAS', v: d.unidades }, 
            { l: 'PALLETS', v: d.pallets }
        ];

        lista.forEach(item => {
            const valNum = parseInt(item.v);
            // Mostramos si es fijo (como Total) O si tiene valor > 0
            if(item.fijo || (item.v && valNum > 0)){
                const div = document.createElement('div');
                div.className = 'item-dato';
                if(item.fijo) div.classList.add('item-total'); // Clase extra por si queres estilizarlo
                
                // Si es undefined o null pero es fijo, ponemos 0
                const valorMostrar = item.v ? item.v : '0';

                div.innerHTML = `<span class="label-dato">${item.l}</span><span class="valor-dato">${valorMostrar}</span>`;
                cont.appendChild(div);
            }
        });

        // QR GENERATION
        const qrString = `ID:${d.id}|P:${d.prod}|L:${d.lote}|TOT:${d.total}`;
        
        new QRCode(document.getElementById("qrcode"), {
            text: qrString,
            width: 250, 
            height: 250,
            correctLevel: QRCode.CorrectLevel.L
        });

        window.onload = () => { setTimeout(() => { window.print(); }, 800); };
    </script>
</body>
</html>
